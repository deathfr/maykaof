<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>œª·¥Ä·¥ä·¥ã·¥Ä.ùóì ‚Äì Premium Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --bg:#0e1014;
    --panel:#171a21;
    --text:#e8e9ea;
    --muted:#9aa0a6;
    --accent:#00c4cc;
    --radius:14px;
}
*{box-sizing:border-box}
body{
    margin:0;
    font-family:Inter,sans-serif;
    background:var(--bg);
    color:var(--text)
}
.layout{
    display:flex;
    max-width:1200px;
    margin:auto;
    padding:20px;
    gap:24px
}
.profile{
    width:320px;
    background:var(--panel);
    border-radius:var(--radius);
    position:sticky;
    top:20px;
    height:calc(100vh - 40px);
    overflow:hidden
}
.banner{
    height:150px;
    background:#222
}
.profile-content{
    padding:18px;
    text-align:center
}
.avatar{
    width:96px;
    height:96px;
    border-radius:50%;
    overflow:hidden;
    margin:-60px auto 12px;
    border:4px solid var(--panel)
}
.avatar img{width:100%;height:100%;object-fit:cover}
.profile-name{font-size:20px;font-weight:700}
.profile-handle{color:var(--muted);font-size:14px}

.feed{flex:1}
.top-bar{
    display:flex;
    justify-content:flex-end;
    gap:10px;
    margin-bottom:16px
}
.add-toggle,.publish-btn{
    background:var(--accent);
    border:none;
    padding:10px 18px;
    border-radius:999px;
    font-weight:600;
    cursor:pointer
}
.publish-btn{
    background:#2a2d35;
    color:#fff
}
.add-post{
    background:var(--panel);
    padding:16px;
    border-radius:var(--radius);
    margin-bottom:20px;
    display:none
}
input,textarea{
    width:100%;
    background:#0b0d11;
    border:1px solid #2a2d35;
    border-radius:10px;
    color:var(--text);
    padding:10px;
    margin-top:8px
}
.post{
    background:var(--panel);
    border-radius:var(--radius);
    padding:16px;
    margin-bottom:22px
}
.slider{
    position:relative;
    background:#000;
    border-radius:12px;
    overflow:hidden;
    cursor:pointer
}
.slider img{
    width:100%;
    max-height:520px;
    object-fit:contain
}
.counter{
    position:absolute;
    bottom:10px;
    right:10px;
    background:rgba(0,0,0,.6);
    padding:4px 10px;
    border-radius:20px;
    font-size:12px
}
.nav{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    background:rgba(0,0,0,.6);
    border:none;
    width:42px;
    height:42px;
    border-radius:50%;
    color:#fff;
    font-size:18px;
    cursor:pointer
}
.prev{left:12px}
.next{right:12px}
.post-title{font-size:18px;font-weight:600;margin-top:14px}
.post-desc{color:var(--muted);font-size:14px;margin-top:6px}
.actions{display:flex;gap:10px;margin-top:12px}
.actions button{
    background:#232631;
    border:none;
    color:#fff;
    padding:6px 14px;
    border-radius:20px;
    cursor:pointer
}
.fullscreen{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.95);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:999
}
.fullscreen img{
    max-width:90%;
    max-height:90%;
    object-fit:contain
}
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1000
}
.modal-box{
    background:var(--panel);
    padding:20px;
    border-radius:var(--radius);
    width:360px
}
.modal-actions{
    display:flex;
    justify-content:flex-end;
    gap:10px;
    margin-top:12px
}
.modal-actions .primary{
    background:var(--accent);
    color:#000
}
</style>
</head>

<body>

<div class="layout">

<div class="profile">
    <div class="banner"></div>
    <div class="profile-content">
        <div class="avatar"><img src="avatar.jpg"></div>
        <div class="profile-name">œª·¥Ä·¥ä·¥ã·¥Ä.ùóì</div>
        <div class="profile-handle">@œª·¥Ä·¥ä·¥ã·¥Ä.ùóì</div>
    </div>
</div>

<div class="feed">

<div class="top-bar" id="creatorBar">
    <button class="add-toggle" onclick="toggleAdd()">‚ûï Nowy post</button>
    <button class="publish-btn" onclick="publishPosts()">üì§ Opublikuj</button>
</div>

<div class="add-post" id="addPostBox">
    <input id="titleInput" placeholder="Tytu≈Ç posta">
    <textarea id="descInput" placeholder="Opis posta"></textarea>
    <input type="file" id="imageInput" multiple accept="image/*">
    <button onclick="addPost()">Dodaj post</button>
</div>

<div id="posts"></div>
</div>
</div>

<div class="modal" id="editModal">
    <div class="modal-box">
        <input id="editTitle">
        <textarea id="editDesc"></textarea>
        <div class="modal-actions">
            <button onclick="closeModal()">Anuluj</button>
            <button class="primary" onclick="saveEdit()">Zapisz</button>
        </div>
    </div>
</div>

<div class="fullscreen" id="fullscreen">
    <img id="fsImg">
</div>

<script>
/* ===== KONFIGURACJA ===== */
const CLOUD_NAME = "dwwvvrjwx";
const UPLOAD_PRESET = "web_unsigned";

/* MUSI BYƒÜ IDENTYCZNY JAK W NETLIFY */
const SAVE_TOKEN = "majka_super_secret_2025";

/* ======================= */

const isCreator = new URLSearchParams(location.search).get("edit")==="true";

let posts = [];
let editIndex = null;
let fsImages=[], fsIndex=0;

const postsEl = document.getElementById("posts");
const addBox = document.getElementById("addPostBox");
const creatorBar = document.getElementById("creatorBar");

if(!isCreator) creatorBar.style.display="none";

function toggleAdd(){
    addBox.style.display = addBox.style.display==="block"?"none":"block";
}

/* ===== CLOUDINARY UPLOAD ===== */
async function addPost(){
    const files=[...imageInput.files];
    if(!files.length) return alert("Wybierz zdjƒôcia");

    const post={title:titleInput.value,desc:descInput.value,images:[]};

    for(const file of files){
        const fd=new FormData();
        fd.append("file",file);
        fd.append("upload_preset",UPLOAD_PRESET);

        const r=await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,{
            method:"POST",body:fd
        });
        const d=await r.json();
        post.images.push(d.secure_url);
    }

    posts.unshift(post);
    render();
    addBox.style.display="none";
    titleInput.value=descInput.value=imageInput.value="";
}

/* ===== MINI BACKEND SAVE ===== */
async function publishPosts(){
    const res = await fetch(`/.netlify/functions/savePosts?token=${SAVE_TOKEN}`,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify(posts)
    });

    if(!res.ok){
        alert("B≈ÇƒÖd publikacji post√≥w");
        return;
    }
    alert("Posty opublikowane üéâ");
}

/* ===== LOAD POSTS FROM NETLIFY ===== */
async function loadPosts(){
    const res = await fetch("/.netlify/functions/getPosts",{cache:"no-store"});
    posts = await res.json();
    render();
}

/* ===== EDIT / DELETE ===== */
function deletePost(i){
    if(confirm("UsunƒÖƒá post?")){
        posts.splice(i,1);
        render();
    }
}
function openEdit(i){
    editIndex=i;
    editTitle.value=posts[i].title;
    editDesc.value=posts[i].desc;
    editModal.style.display="flex";
}
function closeModal(){editModal.style.display="none"}
function saveEdit(){
    posts[editIndex].title=editTitle.value;
    posts[editIndex].desc=editDesc.value;
    render();
    closeModal();
}

/* ===== RENDER ===== */
function render(){
    postsEl.innerHTML="";
    posts.forEach((p,idx)=>{
        let i=0;
        const post=document.createElement("div");
        post.className="post";

        const slider=document.createElement("div");
        slider.className="slider";
        const img=document.createElement("img");
        const counter=document.createElement("div");
        counter.className="counter";

        function update(){
            img.src=p.images[i];
            counter.textContent=`${i+1} / ${p.images.length}`;
        }
        update();

        const prev=document.createElement("button");
        prev.className="nav prev";
        prev.textContent="‚óÄ";
        prev.onclick=e=>{e.stopPropagation();i=(i-1+p.images.length)%p.images.length;update()};

        const next=document.createElement("button");
        next.className="nav next";
        next.textContent="‚ñ∂";
        next.onclick=e=>{e.stopPropagation();i=(i+1)%p.images.length;update()};

        slider.onclick=()=>openFS(p.images,i);
        slider.append(img,prev,next,counter);

        const t=document.createElement("div");
        t.className="post-title";
        t.textContent=p.title;
        const d=document.createElement("div");
        d.className="post-desc";
        d.textContent=p.desc;

        const actions=document.createElement("div");
        actions.className="actions";
        if(isCreator){
            const e=document.createElement("button");
            e.textContent="‚úèÔ∏è";
            e.onclick=()=>openEdit(idx);
            const x=document.createElement("button");
            x.textContent="üóë";
            x.onclick=()=>deletePost(idx);
            actions.append(e,x);
        }

        post.append(slider,t,d,actions);
        postsEl.append(post);
    });
}

/* ===== FULLSCREEN ===== */
function openFS(imgs,start){
    fsImages=imgs;fsIndex=start;
    fullscreen.style.display="flex";
    fsImg.src=fsImages[fsIndex];
}
fullscreen.onclick=()=>fullscreen.style.display="none";

loadPosts();
</script>
</body>
</html>
